#! /usr/bin/env ruby

require_relative '../config/environment'

Application.all.each do |application|
  if application && application.data_retention_hours.present?
    delete_time = Time.now - application.data_retention_hours.hours

    application.transaction_sample_data.where("timestamp < ?", delete_time).delete_all
    application.database_calls.where("timestamp < ?", delete_time).delete_all
    application.traces.where("timestamp < ?", delete_time).delete_all
    application.metrics.where("timestamp < ?", delete_time).delete_all
    application.events.delete_all

    application.error_data.where("created_at < ?", delete_time).delete_all

  end
end
